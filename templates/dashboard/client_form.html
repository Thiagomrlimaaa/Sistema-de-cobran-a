{% extends "dashboard/base.html" %}

{% block title %}{{ object|default_if_none:"Novo cliente" }} - Painel{% endblock %}

{% block content %}
<section class="relative mx-auto max-w-4xl">
    <div class="absolute -left-20 top-0 hidden h-40 w-40 rotate-45 bg-brand-400/30 blur-3xl md:block"></div>
    <div class="absolute -right-32 bottom-0 hidden h-56 w-56 -rotate-12 bg-accent-500/20 blur-3xl md:block"></div>
    <div class="relative rounded-3xl bg-white/95 p-10 shadow-soft ring-1 ring-white/40 backdrop-blur">
        <header class="mb-8 flex flex-col gap-2 border-b border-white/50 pb-4">
            <h1 class="text-3xl font-semibold text-slate-900">
                {% if object %}Editar cliente{% else %}Novo cliente{% endif %}
            </h1>
            <p class="text-sm text-slate-500">
                Defina contato, cobrança e status com a identidade da Luz Rastreamento.
            </p>
        </header>
        <form method="post" novalidate class="space-y-8">
            {% csrf_token %}
            {% if form.non_field_errors %}
                <div class="rounded-2xl border border-brand-200 bg-brand-50 p-4 text-sm font-medium text-brand-700">
                    {% for error in form.non_field_errors %}{{ error }}{% endfor %}
                </div>
            {% endif %}
            <div class="grid gap-6 md:grid-cols-2">
                {% for field in form %}
                    <div class="{% if field.field.widget.input_type == 'checkbox' %}md:col-span-2{% endif %}">
                        <label class="mb-2 block text-sm font-semibold text-slate-600" for="{{ field.id_for_label }}">
                            {{ field.label }}
                        </label>
                        {% if field.field.widget.input_type == 'checkbox' %}
                            <div class="flex items-center gap-3 rounded-2xl border border-slate-200 bg-white/80 px-4 py-3 shadow-sm">
                                {{ field }}
                                <span class="text-sm text-slate-600">
                                    {{ field.help_text|default:"Habilite para que o cliente receba mensagens automáticas." }}
                                </span>
                            </div>
                        {% else %}
                            {{ field }}
                            {% if field.help_text %}
                                <p class="mt-1 text-xs text-slate-400">{{ field.help_text }}</p>
                            {% endif %}
                        {% endif %}
                        {% if field.errors %}
                            <p class="mt-1 text-xs font-semibold text-brand-600">
                                {% for error in field.errors %}{{ error }}{% endfor %}
                            </p>
                        {% endif %}
                    </div>
                {% endfor %}
            </div>
            <div class="flex flex-col gap-3 pt-2 sm:flex-row">
                <button type="submit"
                        class="inline-flex items-center justify-center rounded-2xl bg-brand-500 px-6 py-3 text-sm font-semibold text-white shadow-soft transition hover:bg-brand-600">
                    Salvar
                </button>
                <a href="{% url 'dashboard:clients' %}"
                   class="inline-flex items-center justify-center rounded-2xl border border-slate-200 px-6 py-3 text-sm font-semibold text-slate-600 transition hover:bg-slate-100">
                    Cancelar
                </a>
            </div>
        </form>
    </div>
</section>
<script>
function updateMonthlyFee() {
    const vehicleType = document.getElementById('id_vehicle_type').value;
    const monthlyFeeField = document.getElementById('id_monthly_fee');
    
    if (vehicleType === 'moto') {
        monthlyFeeField.value = '49.99';
    } else if (vehicleType === 'carro') {
        monthlyFeeField.value = '59.99';
    }
}

// Atualizar valor ao carregar a página se já houver um veículo selecionado
document.addEventListener('DOMContentLoaded', function() {
    const vehicleTypeField = document.getElementById('id_vehicle_type');
    if (vehicleTypeField) {
        updateMonthlyFee();
        vehicleTypeField.addEventListener('change', updateMonthlyFee);
    }
});
</script>
{% endblock %}

