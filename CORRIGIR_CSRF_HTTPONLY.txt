================================================================================
  CORRIGIR ERRO 403 - CSRF HTTPONLY
================================================================================

PROBLEMA IDENTIFICADO:
----------------------
CSRF_COOKIE_HTTPONLY = True impede JavaScript de ler o cookie csrftoken.
Isso causa erro 403 ao tentar enviar mensagens via AJAX.

CORRE√á√ïES APLICADAS:
--------------------
‚úÖ CSRF_COOKIE_HTTPONLY = False (permite JavaScript ler o cookie)
‚úÖ Fun√ß√£o getCookie() prioriza input hidden do Django
‚úÖ {% csrf_token %} adicionado no template para criar input hidden
‚úÖ credentials: 'same-origin' mantido para garantir envio de cookies

================================================================================
  O QUE FOI FEITO
================================================================================

1. SETTINGS.PY:
--------------
- CSRF_COOKIE_HTTPONLY alterado de True para False
- Isso permite que JavaScript leia o cookie csrftoken
- Mant√©m seguran√ßa (cookie ainda √© enviado apenas via HTTPS em produ√ß√£o)

2. TEMPLATE (bot_control.html):
--------------------------------
- {% csrf_token %} adicionado dentro do block content
- Cria input hidden com token CSRF como fallback
- Fun√ß√£o getCookie() prioriza input hidden sobre cookie

3. JAVASCRIPT:
-------------
- Fun√ß√£o getCookie() melhorada para buscar token do input hidden primeiro
- Fallback para cookie se input hidden n√£o existir
- Logs de debug para identificar problemas

================================================================================
  PR√ìXIMO PASSO: FAZER DEPLOY
================================================================================

Execute:

"%USERPROFILE%\.fly\bin\flyctl.exe" deploy -a chatbot-cobrana-silent-feather-3785

================================================================================
  SEGURAN√áA
================================================================================

‚ö†Ô∏è IMPORTANTE: CSRF_COOKIE_HTTPONLY = False permite JavaScript ler o cookie.

Isso √© necess√°rio para requisi√ß√µes AJAX, mas:
- O cookie ainda √© enviado apenas via HTTPS em produ√ß√£o (CSRF_COOKIE_SECURE)
- O token ainda √© validado pelo Django
- Apenas o mesmo dom√≠nio pode acessar o cookie (SameSite=Lax)

A seguran√ßa ainda est√° mantida, apenas permite que JavaScript leia o token
para enviar em requisi√ß√µes AJAX.

================================================================================
  SE AINDA DER ERRO 403
================================================================================

1. Verificar se input hidden existe:
   - Abra DevTools (F12)
   - Procure por: <input name="csrfmiddlewaretoken" ...>
   - Se n√£o existir, o {% csrf_token %} n√£o est√° funcionando

2. Verificar console:
   - Veja se h√° mensagem "üîê Token CSRF obtido:"
   - Se n√£o aparecer, o token n√£o est√° sendo obtido

3. Verificar cookies:
   - DevTools ‚Üí Application ‚Üí Cookies
   - Verifique se cookie 'csrftoken' existe
   - Se n√£o existir, fa√ßa login novamente

================================================================================

